

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <meta name="google-site-verification" content="elv6HP48K6bVVMeBdbFYkmoi4IBF6JVtH0WaCgUXRNY" />
  <link rel="apple-touch-icon" sizes="76x76" href="/img/rose.png">
  <link rel="icon" href="/img/rose.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Deng Ye">
  <meta name="keywords" content="">
  
    <meta name="description" content="æ•ˆæœå›¾  GIæ˜¯ä¸¤æ¬¡Bounceçš„æ•ˆæœï¼ŒDIæ˜¯ç›´æ¥å…‰ç…§çš„æ•ˆæœã€‚ ä½œä¸šæ€»è§ˆ  é¢„è®¡ç®—ç¯å¢ƒå…‰ç…§ã€‚  é¢„è®¡ç®—Diffuse Unshadowed LTï¼ˆæœ¬æ–‡ä¸è®²ï¼‰ã€‚  é¢„è®¡ç®—Diffuse Shadowed LTã€‚  ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ®ã€‚  Bonus 1ï¼šæ­£ç¡®å®ç°é¢„è®¡ç®—Diffuse Inter-reflectionã€‚  Bonus 2ï¼šæ­£ç¡®å®ç°SHæ—‹è½¬ï¼ˆæœªå®ç°ï¼‰ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Games202 Hw2 Precomputed Radiance Transfer">
<meta property="og:url" content="https://howl144.github.io/2023/05/29/00016.%20Games202%20Hw2/index.html">
<meta property="og:site_name" content="ğŸ¥°Howl&#39;s Blog">
<meta property="og:description" content="æ•ˆæœå›¾  GIæ˜¯ä¸¤æ¬¡Bounceçš„æ•ˆæœï¼ŒDIæ˜¯ç›´æ¥å…‰ç…§çš„æ•ˆæœã€‚ ä½œä¸šæ€»è§ˆ  é¢„è®¡ç®—ç¯å¢ƒå…‰ç…§ã€‚  é¢„è®¡ç®—Diffuse Unshadowed LTï¼ˆæœ¬æ–‡ä¸è®²ï¼‰ã€‚  é¢„è®¡ç®—Diffuse Shadowed LTã€‚  ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ®ã€‚  Bonus 1ï¼šæ­£ç¡®å®ç°é¢„è®¡ç®—Diffuse Inter-reflectionã€‚  Bonus 2ï¼šæ­£ç¡®å®ç°SHæ—‹è½¬ï¼ˆæœªå®ç°ï¼‰ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://howl144.github.io/img/00016/PRT.gif">
<meta property="article:published_time" content="2023-05-29T02:11:50.000Z">
<meta property="article:modified_time" content="2023-09-14T19:22:34.979Z">
<meta property="article:author" content="Deng Ye">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://howl144.github.io/img/00016/PRT.gif">
  
  
  
  <title>Games202 Hw2 Precomputed Radiance Transfer - ğŸ¥°Howl&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"howl144.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"MY3hK2j6KKqPNCHItX2Yargj-gzGzoHsz","app_key":"U0dZRBpPFA46kRmFcsltQFF2","server_url":"https://my3hk2j6.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Howl&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Portfolio/">
                <i class="iconfont icon-pen"></i>
                <span>Portfolio</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Category</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archive</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About Me</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/post.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.5)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Games202 Hw2 Precomputed Radiance Transfer"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-05-29 10:11" pubdate>
          May 29, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          16k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          132 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> views
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Games202 Hw2 Precomputed Radiance Transfer</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="æ•ˆæœå›¾">æ•ˆæœå›¾</h1>
<p><img src="/img/00016/PRT.gif" srcset="/img/loading.gif" lazyload alt="0" /><br />
<code>GI</code>æ˜¯ä¸¤æ¬¡<code>Bounce</code>çš„æ•ˆæœï¼Œ<code>DI</code>æ˜¯ç›´æ¥å…‰ç…§çš„æ•ˆæœã€‚</p>
<h1 id="ä½œä¸šæ€»è§ˆ">ä½œä¸šæ€»è§ˆ</h1>
<ol type="1">
<li>é¢„è®¡ç®—ç¯å¢ƒå…‰ç…§ã€‚<br />
</li>
<li>é¢„è®¡ç®—<code>Diffuse Unshadowed LT</code>ï¼ˆæœ¬æ–‡ä¸è®²ï¼‰ã€‚<br />
</li>
<li>é¢„è®¡ç®—<code>Diffuse Shadowed LT</code>ã€‚<br />
</li>
<li>ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ®ã€‚<br />
</li>
<li><code>Bonus 1</code>ï¼šæ­£ç¡®å®ç°é¢„è®¡ç®—<code>Diffuse Inter-reflection</code>ã€‚<br />
</li>
<li><code>Bonus 2</code>ï¼šæ­£ç¡®å®ç°<code>SH</code>æ—‹è½¬ï¼ˆæœªå®ç°ï¼‰ã€‚</li>
</ol>
<h1 id="æºç ">æºç </h1>
<p>æš‚æœªå…¬å¼€ã€‚</p>
<h1 id="å‰è¨€">å‰è¨€</h1>
<p>æœ¬æ–‡é‡ç‚¹æ”¾åœ¨ç®—æ³•æœ¬èº«ï¼Œæºç ä¸­ç›¸å…³åœ°æ–¹æ³¨é‡Šå¾ˆæ˜ç¡®ï¼Œå¯¹äºæ¡†æ¶çš„ç†è§£ä¸å†åšè¿‡å¤šè§£é‡Šã€‚<br />
é¢„è®¡ç®—å…‰ä¼ è¾“ï¼ˆPrecomputed Radiance
Transferï¼‰çš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨å¤æ‚å…‰ç…§ç¯å¢ƒä¸‹å®ç°å®æ—¶æ¸²æŸ“ã€‚å®ƒå…¶ä¸­çš„ä¸€ç§æ–¹æ³•æ˜¯åŸºäºçƒé¢è°æ³¢å‡½æ•°ï¼ˆ<a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Spherical_harmonics">Spherical
harmonics</a>ï¼‰æ¥å®Œæˆç¯å¢ƒå…‰çš„é¢„è®¡ç®—ä»¥åŠå…‰ä¼ è¾“çš„é¢„è®¡ç®—ï¼Œç„¶åå°†å®ƒä»¬æŠ•å½±åå¾—åˆ°çš„çƒé¢è°æ³¢ç³»æ•°è¿›è¡Œç‚¹ä¹˜å°±å¯ä»¥å¾—åˆ°å…¨å±€å…‰ç…§çš„æ•ˆæœã€‚é™¤äº†ä½¿ç”¨çƒé¢è°æ³¢å‡½æ•°ä»¥å¤–è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•ï¼Œå…¶ä¸­å¦ä¸€ç§æ˜¯ä½¿ç”¨å°æ³¢å˜ï¼ˆ<a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Wavelet_transform">Wavelet
transform</a>ï¼‰æ¢æ¥è¿›è¡Œé¢„è®¡ç®—ï¼Œå°æ³¢å˜æ¢èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†é«˜é¢‘ç»†èŠ‚ã€‚æœ¬æ–‡ä¼šè®²çƒé¢è°æ³¢å‡½æ•°åœ¨<code>PRT</code>ä¸­çš„åº”ç”¨ä»¥åŠå®ƒçš„è®¡ç®—æ–¹æ³•ï¼Œå¦‚æœå¯¹å°æ³¢å˜æ¢æ„Ÿå…´è¶£å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚</p>
<h1 id="å®ç°">å®ç°</h1>
<p>åœ¨è®²è§£ä½œä¸šçš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç†è§£ä¸€ä¸‹<code>Spherical Harmonic</code>å’Œ<code>Precomputed Radiance Transfer</code>çš„å…³ç³»ï¼Œä»¥ä¾¿åé¢ç†è§£ä¸Šæ²¡æœ‰å›°éš¾ã€‚</p>
<h2 id="relationship-between-sh-and-prt">Relationship between SH and
PRT</h2>
<p>çƒé¢è°æ³¢å‡½æ•°æ˜¯ä¸€ç³»åˆ—å®šä¹‰åœ¨çƒé¢ä¸Šçš„äºŒç»´åŸºå‡½æ•°ï¼ˆå…³äºæ–¹å‘(Î¸ï¼ŒÏ†)çš„å‡½æ•°ï¼‰ï¼Œè¿™äº›åŸºå‡½æ•°åˆç”±ä¼´éšå‹’è®©å¾·å¤šé¡¹å¼ï¼ˆ<a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Associated_Legendre_polynomials">Associated
Legendre
polynomials</a>ï¼‰ç»„æˆçš„ã€‚ä¼´éšå‹’è®©å¾·å¤šé¡¹å¼æ˜¯å‹’è®©å¾·æ–¹ç¨‹çš„ä¸€ç±»è§£ï¼Œè€Œå‹’è®©å¾·æ–¹ç¨‹åˆ™æ˜¯ä¸€ç»„åå¾®åˆ†æ–¹ç¨‹ï¼Œæˆ‘ä»¬å°±ç®€å•ç†è§£æˆä¸€ç§æ•°å­¦å·¥å…·å°±è¡Œã€‚<br />
åé¢å¯¹çƒé¢è°æ³¢åŸºå‡½æ•°çš„æ•°å­¦è¡¨è¾¾å¼ä»¥<span
class="math inline">\(B(w)\)</span>æ¥è¡¨ç¤ºã€‚<br />
ç°åœ¨çš„é—®é¢˜æ˜¯æˆ‘ä»¬è¯¥æ€ä¹ˆç”¨è¿™ä¸ªæ•°å­¦å·¥å…·æ¥å¸®æˆ‘ä»¬é¢„è®¡ç®—ç¯å¢ƒå…‰ä»¥åŠå…‰ä¼ è¾“ã€‚é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯ä»å‚…é‡Œå¶å˜æ¢è¯´èµ·ï¼š<br />
<img src="/img/00016/image.png" srcset="/img/loading.gif" lazyload alt="1" /><br />
<code>f(x)</code>å‡½æ•°å¯ä»¥ç”±è‹¥å¹²ä¸ª<code>sin</code>å’Œ<code>cos</code>å‡½æ•°æ¥é€¼è¿‘ï¼Œè¿™é‡Œå› ä¸º<code>f(x)</code>æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯å¶å‡½æ•°ï¼Œ<code>sin</code>é¡¹å…¨æ˜¯é›¶äº†ã€‚è¿™é‡Œ<code>t,3t,5t...</code>æ˜¯ç”¨æ¥æ§åˆ¶<code>cos</code>çš„é¢‘ç‡ï¼Œè€Œ<span
class="math inline">\(\frac{2A}{\pi}\)</span>è¿™ç§ç³»æ•°æ˜¯æ§åˆ¶ç›¸ä½ï¼Œè¿™æ ·ç”±æ— ç©·ä¸ª<code>cos</code>ç»„æˆçš„å‡½æ•°å¯ä»¥æ— é™é€¼è¿‘åŸå‡½æ•°<code>f(x)</code>ã€‚ä¸€ä¸ªå‡½æ•°å¯ä»¥è¡¨ç¤ºæˆå…¶ä»–å‡½æ•°çš„çº¿æ€§ç»„åˆï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°äº›å‡½æ•°ä¸º<code>åŸºå‡½æ•°</code>ã€‚è¿™é‡ŒåŸºå‡½æ•°å‰é¢ä¹˜ä¸Šä¸€ä¸ªç³»æ•°ç„¶ååŠ èµ·æ¥å°±å¯ä»¥å¾—åˆ°åŸå‡½æ•°äº†:<br />
<span class="math display">\[
\begin{align}
f(x)=\sum_{i}c_i\cdot B_i(x) \tag{1}
\end{align}
\]</span>
è¿™äº›ç³»æ•°å¯ä»¥ç”±æŠ•å½±æ“ä½œå¾—åˆ°ï¼Œä¹Ÿå°±æ˜¯ä¸¤ç§å‡½æ•°<code>f(w)</code>,<code>B(w)</code>çš„ä¹˜ç§¯å†ç§¯åˆ†ï¼š<br />
<span class="math display">\[
\begin{align}
c_i=\int_{\Omega}f(w)B_i(w)\text{d}w \tag{2}
\end{align}
\]</span>
è¿™é‡Œ<code>f(w)</code>å°±æ˜¯æˆ‘ä»¬è¦çš„<code>åŸå‡½æ•°</code>ï¼Œ<code>B(w)</code>åˆ™æ˜¯ä¸€ç³»åˆ—<code>çƒé¢è°æ³¢åŸºå‡½æ•°</code>ã€‚åªè¦æœ‰ä¸¤ç§å‡½æ•°å­˜åœ¨è¿™æ ·çš„ä¸€ç§è®¡ç®—æ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿè®¤ä¸ºè¿™å­˜åœ¨ä¸€å®šçš„æ»¤æ³¢æ„ä¹‰ã€‚è€Œæ»¤æ³¢åå¾—åˆ°çš„å€¼ï¼Œè¯¥å€¼çš„é¢‘ç‡ç”±<code>f(w)</code>å’Œ<code>B(w)</code>ä¸­æœ€ä½é¢‘çš„å‡½æ•°å†³å®šã€‚</p>
<p>çƒé¢è°æ³¢åŸºå‡½æ•°çš„å¯è§†åŒ–å¦‚ä¸‹ï¼š<br />
<img src="/img/00016/image-1.png" srcset="/img/loading.gif" lazyload alt="2" /><br />
å…¶ä¸­å‰<code>n</code>å±‚çš„åŸºå‡½æ•°ä¸ªæ•°ä¸º<code>n^2</code>ï¼Œé¢œè‰²è¡¨åŸºå‡½æ•°çš„å€¼ï¼Œè¶Šè“çš„åœ°æ–¹å€¼è¶Šå¤§ï¼Œè¶Šé»„çš„åœ°æ–¹å…¶ç»å¯¹å€¼è¶Šå¤§ã€‚è€Œé¢‘ç‡å°±æ˜¯è¿™äº›å€¼çš„å˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„å‡½æ•°é¢‘ç‡æ¯”ä¸Šé¢çš„å‡½æ•°è¦å¤§ã€‚<code>l</code>å±‚æ•°è¶Šå¤§ç”¨åˆ°çš„åŸºå‡½æ•°è¶Šå¤šï¼Œå°±èƒ½è¡¨ç¤ºåŸå‡½æ•°æ›´é«˜é¢‘çš„å†…å®¹ï¼Œä½†æ˜¯å¦‚æœåŸå‡½æ•°æœ¬æ¥å°±å¾ˆä½é¢‘ï¼Œæˆ–è€…å› ä¸ºè¯¥å‡½æ•°<code>f(x)</code>ä¸ä¸€ä¸ªå¾ˆä½é¢‘çš„å‡½æ•°<code>g(x)</code>è¿›è¡Œä¹˜ç§¯å†ç§¯åˆ†ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦ç”¨å‰å‡ å±‚çš„åŸºå‡½æ•°å°±å¯ä»¥æ¢å¤å‡ºåŸå‡½æ•°ã€‚<br />
æ‰€ä»¥æˆ‘ä»¬ç”¨çƒé¢è°æ³¢åŸºå‡½æ•°æ¥æ¢å¤<code>Diffuse</code>ç‰©ä½“çš„å…‰ç…§å°±éå¸¸åˆé€‚ï¼Œ<code>Diffuse</code>ç‰©ä½“çš„<code>BRDF</code>æ˜¯ä¸€ä¸ªå¸¸æ•°<span
class="math inline">\(\frac{c}{\pi}\)</span>ï¼Œè€Œæ‰€éœ€è¦çš„å…‰ç…§ä¹Ÿä¸éœ€è¦å¾ˆé«˜é¢‘ã€‚å®éªŒè¡¨æ˜ï¼Œç”¨å‰ä¸‰å±‚çš„åŸºå‡½æ•°æ¢å¤å‡ºçš„å…‰ç…§ä¿¡æ¯å°±å¯ä»¥ä½¿<code>Diffuse</code>ç‰©ä½“çš„<code>Shading</code>ç»“æœéå¸¸æ­£ç¡®ï¼Œå¹³å‡è¯¯å·®å°äº<code>3%</code>:<br />
<img src="/img/00016/image-2.png" srcset="/img/loading.gif" lazyload alt="3" /><br />
éœ€è¦æ³¨æ„çš„æ˜¯çƒé¢è°æ³¢åŸºå‡½æ•°æ˜¯ç”¨æ¥æ¢å¤å…‰ç…§å’Œå…‰ä¼ è¾“ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¸²æŸ“æ–¹ç¨‹ï¼š<br />
<img src="/img/00016/image-3.png" srcset="/img/loading.gif" lazyload alt="4" /><br />
<code>Lighting</code>éƒ¨åˆ†å’Œ<code>Light transport</code>éƒ¨åˆ†éƒ½å¯ä»¥é€šè¿‡çƒé¢è°æ³¢åŸºå‡½æ•°æ¥è¿‘ä¼¼ã€‚å¯¹äº<code>Lighting</code>éƒ¨åˆ†ï¼Œç”±äºåŸºå‡½æ•°æ˜¯å›ºå®šçš„ï¼Œåªè¦æˆ‘ä»¬æ±‚å‡ºäº†åœºæ™¯å…‰ç…§å¯¹åº”çš„åŸºå‡½æ•°ç³»æ•°ï¼Œåœ¨åœºæ™¯åˆ‡æ¢æ—¶ï¼Œ<code>shading</code>ç»“æœä¹Ÿå¯ä»¥å‘ç”Ÿæ”¹å˜ã€‚ä½†æ˜¯<code>Light transport</code>éƒ¨åˆ†ï¼Œç”±äºé¢„è®¡ç®—æ—¶ï¼Œæ¯ä¸€ä¸ª<code>Shading point</code>çœ‹å‘åœºæ™¯çš„<code>visibility</code>é¡¹éœ€è¦å›ºå®šä½ï¼Œæ‰€ä»¥åœºæ™¯ä¸­çš„ç‰©ä½“ä¸èƒ½å‘ç”Ÿæ”¹åŠ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç¼ºç‚¹ã€‚</p>
<p>å¯¹äºè¿™æ ·ä¸€ä¸ªæ¸²æŸ“æ–¹ç¨‹ï¼Œæˆ‘ä»¬å‡è®¾å…‰æºå¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œåœºæ™¯ä¸­çš„ç‰©ä½“éƒ½ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>Lighting</code>å’Œ<code>Light transport</code>æŠ•å½±åˆ°çƒé¢è°æ³¢åŸºå‡½æ•°ä¸Šï¼Œç„¶åè¿›è¡Œé¢„è®¡ç®—ï¼Œå¾—åˆ°ä»–ä»¬çš„åŸºå‡½æ•°ç³»æ•°ï¼Œæœ€åç”¨è¿™äº›ç³»æ•°æ¥è®¡ç®—<code>shading</code>çš„ç»“æœï¼Œè¿™å°±æ˜¯<code>PRT</code>åšçš„äº‹æƒ…ã€‚<br />
ç°åœ¨çš„é—®é¢˜æ˜¯æˆ‘ä»¬æ€ä¹ˆé€šè¿‡è¿™äº›åŸºå‡½æ•°ç³»æ•°æ¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„<code>Shading</code>ç»“æœï¼Œæˆ‘ä»¬æ¥æ·±å…¥äº†è§£ä¸€ä¸‹æ¸²æŸ“æ–¹ç¨‹ç»è¿‡æŠ•å½±çš„å½¢å¼ï¼Œè¿™é‡Œä»¥<code>Diffuse</code>ç‰©ä½“çš„æ¸²æŸ“æ–¹ç¨‹ä¸ºä¾‹ï¼š<br />
<img src="/img/00016/image-4.png" srcset="/img/loading.gif" lazyload alt="5" /><br />
è¿™é‡Œ<span class="math inline">\(f_r(p,w_i,w_o)\)</span>ä¸ºå¸¸æ•°<span
class="math inline">\(\frac{c}{\pi}\)</span>ï¼Œæ•´ä¸ªå³è¾¹æ©™è‰²æ¡†å†…çš„å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªäºŒç»´çš„çƒé¢å‡½æ•°ï¼Œå› ä¸º<code>Diffuse</code>ç‰©ä½“åœ¨ä»»ä½•æ–¹å‘çœ‹åˆ°ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå³è·Ÿ<code>W_o</code>æ— å…³ã€‚å°†<code>Lighting</code>å’Œ<code>Light transport</code>ç”¨åŸºå‡½æ•°ç³»æ•°å’ŒåŸºå‡½æ•°çš„è¡¨è¾¾å¼å¸¦å…¥æ–¹ç¨‹ä¸­å¾—ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
L_o(p,w_o)=\int_{\Omega+}L_i(p,w_i)f_r(p,w_i,w_o)cos\theta_iV(p,w_i)\text{d}w_i
\\
&amp; =\int_{\Omega+}\sum_pl_pB_p(w_i)\sum_qt_qB_q(w_i) \\
&amp; =\sum_p\sum_ql_pt_q\int_{\Omega+}B_p(w_i)B_q(w_i)\text{d}w_i
\tag{3}
\end{align}
\]</span>
è¿™é‡Œæ±‚å’Œçš„ç§¯åˆ†å’Œç§¯åˆ†çš„æ±‚å’Œåœ¨å›¾å½¢å­¦ä¸­å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯å¯ä»¥äº¤æ¢çš„ã€‚<br />
ç”±äºçƒé¢è°æ³¢åŸºå‡½æ•°æ˜¯ä¸€ç»„æ ‡å‡†æ­£äº¤åŸºå‡½æ•°ï¼Œæ‰€ä»¥å…¶å…·å¤‡ä¸€ä¸‹æ€§è´¨ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; \int_{\Omega+}B_i(w)B_j(w)\text{d}w=0,i\neq j \\
&amp; \int_{\Omega+}B_i(w)B_j(w)\text{d}w=1,i=j \tag{4}
\end{align}
\]</span> æ‰€ä»¥ä¸Šé¢<code>3</code>å¼å¯ä»¥å†™æˆä»¥ä¸‹å½¢å¼ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; =\sum_p\sum_ql_pt_q\int_{\Omega+}B_p(w_i)B_q(w_i)\text{d}w_i \\
&amp; =\sum_il_it_i \tag{5}
\end{align}
\]</span>
å¦‚æœ<code>Lighting</code>å’Œ<code>Light transport</code>æŠ•å½±åˆ°çƒé¢è°æ³¢åŸºå‡½æ•°çš„å‰<code>3</code>å±‚ï¼Œåˆ™æœ€åå¾—åˆ°çš„åŸºå‡½æ•°ç³»æ•°<code>l_i</code>å’Œ<code>t_i</code>,éƒ½æ˜¯<code>9</code>ç»´å‘é‡ï¼Œåœ¨æœ€å<code>shading</code>æ—¶ï¼Œåƒç´ æ˜¾ç¤ºå‡ºæ¥çš„é¢œè‰²å°±æ˜¯å®ƒä»¬çš„ç‚¹ä¹˜ç»“æœã€‚</p>
<h2 id="calculate-the-real-basis-spherical-harmonics">Calculate the real
basis spherical harmonics</h2>
<p>ä¸Šé¢å°èŠ‚æˆ‘ä»¬å·²ç»å¤§è‡´ç†è§£äº†çƒé¢è°æ³¢åŸºå‡½æ•°æ˜¯å¦‚ä½•ç”¨æ¥é¢„è®¡ç®—å…‰ç…§å’Œå…‰ä¼ è¾“ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªåŸºå‡½æ•°æ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘æƒ³å¾ˆå¤šäººè·Ÿæˆ‘ä¸€æ ·æœ‰äº›ç–‘æƒ‘ã€‚è¿™ä¸€å°èŠ‚æˆ‘ä»¬å°±æ¥çœ‹ä¸‹å…·ä½“çš„ä¸€ä¸ªåŸºå‡½æ•°æ˜¯æ€ä¹ˆæ ·ç®—å¾—çš„ï¼Œä»¥åå¦‚æœéœ€è¦ç”¨åˆ°é«˜å±‚åŸºå‡½æ•°ï¼Œèƒ½è‡ªå·±é€šè¿‡ç¨‹åºç®—å‡ºæ¥ã€‚ä¸‹é¢å†…å®¹å¤§éƒ¨åˆ†æ¥è‡ªç»´åŸºç™¾ç§‘ï¼Œæˆ‘åªæ˜¯åšå¥½äº†æ•´ç†å·¥ä½œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚</p>
<p><code>SHå‡½æ•°</code>é€šå¸¸æ˜¯åœ¨å¤æ•°åŸŸä¸Šå®šä¹‰çš„ï¼Œè€Œå®æ•°åŸŸçš„<code>SHåŸºå‡½æ•°</code>åˆå¯ä»¥ç”±å¤æ•°åŸŸä¸Šå®šä¹‰çš„<code>SHå‡½æ•°</code>ç®—å¾—ï¼Œ<code>SHåŸºå‡½æ•°</code>åˆ™æ˜¯ç”±<code>ä¼´éšå‹’è®©å¾·å¤šé¡¹å¼</code>ä»¥åŠ<code>å½’ä¸€åŒ–ç³»æ•°</code>ç»„æˆï¼š<br />
The real spherical harmonics<br />
<img src="/img/00016/image-5.png" srcset="/img/loading.gif" lazyload alt="6" /><br />
The complex spherical harmonics<br />
<img src="/img/00016/image-6.png" srcset="/img/loading.gif" lazyload alt="7" /><br />
The real basis spherical harmonics<br />
<img src="/img/00016/image-7.png" srcset="/img/loading.gif" lazyload alt="8" /><br />
å…¶ä¸­<span
class="math inline">\(P_{l}^{m}(cos\theta)\)</span>ä¸º<code>ä¼´éšå‹’è®©å¾·å¤šé¡¹å¼</code>ï¼Œå®ƒæ˜¯<code>å‹’è®©å¾·åå¾®åˆ†æ–¹ç¨‹</code>çš„ä¸€ç»„è§£ï¼Œå…¶é—­å¼ä¸ºï¼š<br />
<img src="/img/00016/image-8.png" srcset="/img/loading.gif" lazyload alt="9" /><br />
å…¶ä¸­åé¢ä¸¤ä¸ªæ‹¬å·æ‹¬èµ·æ¥çš„ä¸œè¥¿å«åš<a
href="%5BBinomial%20coefficient%5D(https://en.wikipedia.org/wiki/Binomial_coefficient#Generalization_and_connection_to_the_binomial_series)">äºŒé¡¹å¼ç³»æ•°</a>ï¼Œå…¶é˜¶ä¹˜å¼å¦‚ä¸‹ï¼š<br />
<img src="/img/00016/image-9.png" srcset="/img/loading.gif" lazyload alt="10" /><br />
ä¸Šé¢å¼å­çš„æ¥æºæˆ–å®šä¹‰å•¥çš„ï¼Œæˆ‘ä»¬å°±ä¸åœ¨ç»†ç©¶äº†ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è¦ææ‡‚<code>å®åŸŸSHåŸºå‡½æ•°</code>æ€ä¹ˆç®—ï¼</p>
<p>è¿™ä¸ªä¼´éšå‹’è®©å¾·å¤šé¡¹å¼çš„é—­å¼æœ‰ç‚¹å¤æ‚ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—ï¼Œä½†æ˜¯å¦‚æœç”¨è®¡ç®—æœºæ¥ç®—çš„è¯è¿™ä¸ªå¼å­ä¸æ˜¯å¾ˆå‹å¥½ï¼Œä½†æ˜¯åœ¨<code>l</code>å’Œ<code>m</code>ç›¸ç­‰æ—¶ï¼Œå®ƒå¯ä»¥å†™æˆå¦ä¸€ç§è¡¨è¾¾å¼ï¼Œä¸‹é¢å¼å­<a
target="_blank" rel="noopener" href="https://mathworld.wolfram.com/AssociatedLegendrePolynomial.html">æ¥æºäºæ­¤</a>ï¼š<br />
<span class="math display">\[
\begin{align}
P_{m}^{m}=(-1)^m(2m-1)!!(1-x^2)^{\frac{m}{2}} \tag{6}
\end{align}
\]</span> <span class="math display">\[
\begin{align}
P_{m+1}^{m}=x(2m+1)P_{m}^{m} \tag{7}
\end{align}
\]</span> æœ‰äº†è¿™ä¸¤ä¸ªé€’æ¨å…¬å¼ï¼Œé«˜å±‚<span
class="math inline">\(P_{l}^{m}(x)\)</span>ï¼Œå°±å¯ä»¥é€šè¿‡ç¨‹åºæ¥é€’æ¨ç”Ÿæˆï¼Œå½“ç„¶æˆ‘è¿™é‡Œæ²¡æœ‰ç”¨ä»£ç æ¥å®ç°è¿™ä¸ªç®—æ³•ï¼Œç­‰åˆ°ä»€ä¹ˆæ—¶å€™è¦ç”¨çš„æ—¶å€™å†æ¥å®ç°ä¹Ÿä¸è¿ŸğŸ˜ã€‚</p>
<p>å¥½äº†è™½ç„¶æ²¡æœ‰ç”¨ä»£ç æ¥å®ç°è¿™éƒ¨åˆ†å†…å®¹ï¼Œä½†æ˜¯æˆ‘å¯ä»¥æ‰‹ç®—ä¸€ä¸ªä¾‹å­ï¼Œæ¥ç†ä¸€ä¸‹é€»è¾‘ï¼Œå°±ä»¥<code>Real spherical harmonics</code>çš„<span
class="math inline">\(Y_{1,-1}\)</span>ä¸ºä¾‹ï¼Œä¾‹å­å¯ä»¥åœ¨<a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Table_of_spherical_harmonics">è¿™é‡Œ</a>æ‰¾åˆ°ï¼š<br />
<img src="/img/00016/image-10.png" srcset="/img/loading.gif" lazyload alt="11" />
å°†l=1,m=-1å¸¦å…¥åˆ°ä¸Šé¢<code>The real spherical harmonics</code>å¾—ï¼š<br />
<span class="math display">\[
\begin{align}
Y_{1,-1}=\frac{i}{\sqrt{2}}(Y_{1}^{-1}+Y_{1}^{1}) \tag{7}
\end{align}
\]</span> å…¶ä¸­<span class="math inline">\(Y_{1}^{-1}\)</span>å’Œ<span
class="math inline">\(Y_{1}^{1}\)</span>æ˜¯å¤æ•°åŸŸçš„<code>SHå‡½æ•°</code>ï¼Œæ ¹æ®æ¬§æ‹‰å…¬å¼å’Œ<code>SH</code>åŸºå‡½æ•°å…¬å¼ä»¥åŠä¼´éšå‹’è®©å¾·å…¬å¼ï¼Œåˆ†åˆ«è®¡ç®—å®ƒä»¬ï¼š<br />
<span class="math display">\[
\begin{align}
\text{e}^{\pm i\phi}=\cos\phi\pm i\sin\phi \tag{8}
\end{align}
\]</span> <span class="math display">\[
\begin{align}
&amp;
Y_{1}^{-1}=\frac{1}{\sqrt{2}}(-\sqrt{\frac{3}{4\pi}})\cdot(-(1-\cos^2\theta)^{\frac{1}{2}})\cdot(\cos(\phi)-i\sin(\phi))
\\
&amp;
Y_{1}^{-1}=\frac{1}{2}\sqrt{\frac{3}{2\pi}}\sin\theta\cdot\text{e}^{-i\phi}
\tag{9}
\end{align}
\]</span> <span class="math display">\[
\begin{align}
&amp;
Y_{1}^{1}=-\frac{1}{\sqrt{2}}(-\sqrt{\frac{3}{4\pi}})\cdot(-(1-\cos^2\theta)^{\frac{1}{2}})\cdot(\cos(\phi)+i\sin(\phi))
\\
&amp;
Y_{1}^{1}=-\frac{1}{2}\sqrt{\frac{3}{2\pi}}\sin\theta\cdot\text{e}^{i\phi}
\tag{10}
\end{align}
\]</span>
å†æ ¹æ®çƒåæ ‡è½¬ç¬›å¡å°”åæ ‡å…¬å¼ï¼Œå¾—åˆ°å¤æ•°åŸŸç¬›å¡å°”åæ ‡ç³»ä¸‹çš„<code>SHå‡½æ•°</code>ï¼š<br />
<img src="/img/00016/image-11.png" srcset="/img/loading.gif" lazyload alt="12" /><br />
<span class="math display">\[
\begin{align}
&amp;
Y_{1}^{-1}=\frac{1}{2}\sqrt{\frac{3}{2\pi}}\sin\theta\cdot\text{e}^{-i\phi}
\\
&amp; Y_{1}^{-1}=\frac{1}{2}\sqrt{\frac{3}{2\pi}}\frac{x-iy}{r} \tag{11}
\end{align}
\]</span> <span class="math display">\[
\begin{align}
&amp;
Y_{1}^{1}=-\frac{1}{2}\sqrt{\frac{3}{2\pi}}\sin\theta\cdot\text{e}^{i\phi}
\\
&amp; Y_{1}^{1}=-\frac{1}{2}\sqrt{\frac{3}{2\pi}}\frac{x+iy}{r} \tag{12}
\end{align}
\]</span>
å°†ä¸Šé¢<code>11</code>å¼å’Œ<code>12</code>å¼å¸¦å…¥åˆ°<code>7</code>å¼ä¸­ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; Y_{1,-1}=\frac{i}{\sqrt{2}}(Y_{1}^{-1}+Y_{1}^{1}) \\
&amp;
Y_{1,-1}=\frac{i}{\sqrt{2}}(\frac{1}{2}\sqrt{\frac{3}{2\pi}}\frac{x-iy}{r}-\frac{1}{2}\sqrt{\frac{3}{2\pi}}\frac{x+iy}{r})
\\
&amp; Y_{1,-1}=\frac{1}{\sqrt{2}}\sqrt{\frac{3}{2\pi}}\frac{-i^2y}{r} \\
&amp; Y_{1,-1}=\sqrt{\frac{3}{4\pi}}\frac{y}{r} \tag{13}
\end{align}
\]</span></p>
<p>è¿™æ ·å°±å¾—åˆ°äº†å›¾å½¢å­¦ä¸­ç»å¸¸ç”¨<code>SHå‡½æ•°</code>ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå¼å­ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼š<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">HardcodedSH1n1</span><span class="hljs-params">(<span class="hljs-type">const</span> Eigen::Vector3d&amp; d)</span> </span>&#123;<br>  <span class="hljs-comment">// -sqrt(3/(4pi)) * y</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">-0.488603</span> * d.<span class="hljs-built_in">y</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
è¿™é‡Œ<code>r</code>=1ï¼Œä½†æ˜¯æˆ‘ç›®å‰è¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦åŠ è´Ÿå·ğŸ˜‘ï¼Œå¯èƒ½æ˜¯<code>cubemap</code>æ–¹å‘å‘é‡çš„åæ ‡ç³»å’Œ<code>SHå‡½æ•°</code>çš„åæ ‡ç³»ä¸åŒå¯¼è‡´çš„ã€‚</p>
<h2 id="é¢„è®¡ç®—ç¯å¢ƒå…‰ç…§">é¢„è®¡ç®—ç¯å¢ƒå…‰ç…§</h2>
<p>è¿™éƒ¨åˆ†è¿˜æ˜¯æ ¹æ®ä¸Šé¢<code>2</code>å¼æŠ•å½±å…¬å¼æ¥ç®—ç¯å¢ƒå…‰ç…§çš„<code>SH</code>ç³»æ•°ï¼Œè¿™é‡Œå°†å®ƒè½¬æ¢ä¸ºé»æ›¼å’Œæ±‚å…¶ç§¯åˆ†:<br />
<span class="math display">\[
\begin{align}
&amp; SH_{coeff}=\int_{S}L_{env}(w_i)SH(w_i)\text{d}w_i \\
&amp; \widehat{SH_{coeff}}=\sum_iL_{env}(w_i)SH(w_i)\Delta w_i \tag{14}
\end{align}
\]</span> è¿™é‡Œç”¨é»æ›¼å’Œçš„æ–¹å¼æ±‚ç§¯åˆ†çš„å¥½å¤„æ˜¯ï¼Œ<a
target="_blank" rel="noopener" href="https://www.rorydriscoll.com/2012/01/15/cubemap-texel-solid-angle/">æœ‰ä¸ªåŠæ³•</a>å¯ä»¥ç²¾ç¡®æ±‚å‡ºåƒç´ æŠ•å½±åˆ°å•ä½çƒä¸Šçš„é¢ç§¯ï¼Œå¦‚å›¾ï¼š<br />
<img src="/img/00016/image-12.png" srcset="/img/loading.gif" lazyload alt="13" /><br />
æˆ‘è¿™é‡Œç®€å•æ¦‚è¿°ä¸€ä¸‹å®ƒè¿™ä¸ªæ–¹æ³•æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚
é¦–å…ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¡†æ¶ç»™çš„æ–¹æ³•æ±‚å‡ºæ¯ä¸ªåƒç´ å¯¹åº”çš„å‘é‡ï¼ˆæœªå½’ä¸€åŒ–ï¼‰ï¼š
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">//ç´¢å¼•åƒç´ å¯¹åº”çš„æ–¹å‘</span><br>Eigen::Vector3f dir = cubemapDirs[i * width * height + y * width + x];<br></code></pre></td></tr></table></figure> ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¯¥å‘é‡å½’ä¸€åŒ–åçš„è¡¨è¾¾å¼ï¼š<br />
<span class="math display">\[
\begin{align}
\vec{p}=\frac{(x,y,1)}{\sqrt{x^2+y^2+1}} \tag{15}
\end{align}
\]</span> è¿™ä¸ªå‘é‡çš„<code>z</code>åˆ†é‡å¦‚ä¸‹ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; p_z=\frac{1}{\sqrt{x^2+y^2+1}} \\
&amp; =(x^2+y^2+1)^{-\frac{1}{2}} \\
&amp; =u^{-\frac{1}{2}}
\tag{16}
\end{align}
\]</span>
ç„¶åé€šè¿‡é“¾å¼æ³•åˆ™ï¼Œå¯¹å®ƒè¿›è¡Œæ±‚åå¯¼ï¼Œå¾—åˆ°è¯¥<code>z</code>åˆ†é‡æ²¿<code>x</code>è½´çš„å˜åŒ–ç‡ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
\frac{\partial{p_z}}{\partial{x}}=\frac{\partial{p_z}}{\partial{u}}\frac{\partial{u}}{\partial{x}}
\\
&amp; =-\frac{x}{(x^2+y^2+1)^{\frac{3}{2}}}
\tag{17}
\end{align}
\]</span>
æœ‰äº†<code>z</code>åˆ†é‡çš„åå¯¼ï¼Œ<code>x</code>åˆ†é‡å¯ä»¥è¡¨ç¤ºä¸ºï¼š<br />
<span class="math display">\[
\begin{align}
&amp; p_x=\frac{x}{\sqrt{x^2+y^2+1}} \\
&amp; =xp_z
\end{align} \tag{18}
\]</span> å¯¹å…¶æ±‚åå¯¼å¯ä»¥ç”¨ä¹˜ç§¯æ³•åˆ™å†™æˆä»¥ä¸‹å½¢å¼ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
\frac{\partial{p_x}}{\partial{x}}=p_z\frac{\partial{x}}{\partial{x}}+x\frac{\partial{p_z}}{\partial{x}}
\\
&amp; =\frac{y^2+1}{(x^2+y^2+1)^{\frac{3}{2}}}
\end{align} \tag{19}
\]</span> <code>y</code>åˆ†é‡ä¹Ÿå¯ä»¥ç”¨ç›¸åŒæ–¹å¼æ±‚åå¯¼ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; p_y=\frac{y}{\sqrt{x^2+y^2+1}}=yp_z \\
&amp;
\frac{\partial{p_y}}{\partial{x}}=p_z\frac{\partial{y}}{\partial{x}}+y\frac{\partial{p_z}}{\partial{x}}
\\
&amp; =-\frac{xy}{(x^2+y^2+1)^{\frac{3}{2}}}
\end{align} \tag{19}
\]</span> ä»¥ç›¸åŒæ–¹å¼å¯ä»¥æ±‚å¾—è¯¥å‘é‡æ²¿<code>y</code>è½´çš„å˜åŒ–ç‡ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
\frac{\partial{\vec{p}}}{\partial{x}}=\frac{(y^2+1,-xy,-x)}{(x^2+y^2+1)^{\frac{3}{2}}}
\\
&amp;
\frac{\partial{\vec{p}}}{\partial{y}}=\frac{(-xy,x^2+1,-y)}{(x^2+y^2+1)^{\frac{3}{2}}}
\end{align} \tag{20}
\]</span>
ç„¶åç®—<code>x</code>è½´çš„å˜åŒ–ç‡å‰ä¹˜<code>y</code>è½´å˜åŒ–ç‡ï¼Œå¾—åˆ°å‰ä¹˜åçš„å‘é‡ï¼Œå†æ±‚å®ƒçš„æ¨¡å°±æ˜¯åŸç‚¹å’Œå˜åŒ–ç‚¹é—´çš„å¾®åˆ†é¢ç§¯ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
\vec{r}=\frac{\partial{\vec{p}}}{\partial{x}}\times\frac{\partial{\vec{p}}}{\partial{y}}
\\
&amp; =\frac{(x,y,1)}{(x^2+y^2+1)^2}
\end{align} \tag{21}
\]</span> <span class="math display">\[
\begin{align}
&amp; \partial{A}=\sqrt{\vec{r}\cdot\vec{r}} \\
&amp; =\frac{1}{(x^2+y^2+1)^{\frac{3}{2}}}
\end{align} \tag{22}
\]</span>
æœ€åä¸€æ­¥æ˜¯åœ¨åƒç´ ç©ºé—´å†…å¯¹å¾®åˆ†é¢ç§¯è¿›è¡Œç§¯åˆ†ï¼Œä»¥è·å¾—åƒç´ æŠ•å½±åˆ°å•ä½çƒä¸Šçš„ç«‹ä½“è§’ã€‚æˆ‘ä»¬å¯ä»¥è®¡ç®—åŸç‚¹<code>(0,0)</code>åˆ°<code>cubemap</code>ä¸Šçš„æŸä¸ªç‚¹<code>(s,t)</code>çš„ç§¯åˆ†å€¼ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
f(s,t)=\int_{y=0}^{t}\int_{x=0}^{s}\frac{1}{(x^2+y^2+1)^{\frac{3}{2}}}\text{d}x\text{d}y
\\
&amp; =\tan^{-1}\frac{st}{\sqrt{s^2+t^2+1}}
\end{align} \tag{23}
\]</span>
æœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸¤ä¸ªå³å¯¹è§’<code>A</code>å’Œ<code>C</code>çš„é¢ç§¯åŠ åœ¨ä¸€èµ·ï¼Œå‡å»å·¦å¯¹è§’<code>B</code>å’Œ<code>D</code>çš„é¢ç§¯æ¥è®¡ç®—ä»»ä½•åƒç´ æŠ•å½±åˆ°å•ä½çƒçš„ç«‹ä½“è§’ï¼š<br />
<img src="/img/00016/image-13.png" srcset="/img/loading.gif" lazyload alt="14" /><br />
å¯¹åº”çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">CalcPreArea</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">float</span> &amp;x, <span class="hljs-type">const</span> <span class="hljs-type">float</span> &amp;y)</span></span>&#123;<br>    <span class="hljs-comment">//atan2çš„ä¼˜åŠ¿æ˜¯å¯ä»¥æ­£ç¡®å¤„ç†å¼‚å¸¸çš„æƒ…å†µ</span><br>    <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">atan2</span>(x * y, std::<span class="hljs-built_in">sqrt</span>(x * x + y * y + <span class="hljs-number">1.0</span>));<br>&#125;<br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">CalcArea</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">float</span> &amp;u_, <span class="hljs-type">const</span> <span class="hljs-type">float</span> &amp;v_, <span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp;width,</span></span><br><span class="hljs-params"><span class="hljs-function">                <span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp;height)</span></span>&#123;<br>    <span class="hljs-comment">// transform from [0,1] to [-1,1]</span><br>    <span class="hljs-comment">// ( 0.5 is for texel center addressing)</span><br>    <span class="hljs-type">float</span> u = (<span class="hljs-number">2.0</span> * (u_ + <span class="hljs-number">0.5</span>) / width) - <span class="hljs-number">1.0</span>;<br>    <span class="hljs-type">float</span> v = (<span class="hljs-number">2.0</span> * (v_ + <span class="hljs-number">0.5</span>) / height) - <span class="hljs-number">1.0</span>;<br><br>    <span class="hljs-type">float</span> invResolutionW = <span class="hljs-number">1.0</span> / width;<br>    <span class="hljs-type">float</span> invResolutionH = <span class="hljs-number">1.0</span> / height;<br><br>    <span class="hljs-comment">// u and v are the [-1,1] texture coordinate on the current face.</span><br>    <span class="hljs-comment">// get projected area for this texel</span><br>    <span class="hljs-type">float</span> x0 = u - invResolutionW;<br>    <span class="hljs-type">float</span> y0 = v - invResolutionH;<br>    <span class="hljs-type">float</span> x1 = u + invResolutionW;<br>    <span class="hljs-type">float</span> y1 = v + invResolutionH;<br>    <span class="hljs-type">float</span> angle = <span class="hljs-built_in">CalcPreArea</span>(x0, y0) - <span class="hljs-built_in">CalcPreArea</span>(x0, y1) -<br>                    <span class="hljs-built_in">CalcPreArea</span>(x1, y0) + <span class="hljs-built_in">CalcPreArea</span>(x1, y1);<br><br>    <span class="hljs-keyword">return</span> angle;<br>&#125;<br></code></pre></td></tr></table></figure> å›åˆ°ä¸Šé¢<code>14</code>å¼ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; \widehat{SH_{coeff}}=\sum_iL_{env}(w_i)SH(w_i)\Delta w_i
\end{align}
\]</span>
æœ‰äº†ç«‹ä½“è§’çš„é¢ç§¯ï¼Œæ¡†æ¶ä¹Ÿæä¾›äº†ç¯å¢ƒå…‰çš„<code>RGB</code>å€¼ä»¥åŠç¡¬ç¼–ç çš„<code>SH</code>å‡½æ•°ï¼Œå®ç°å°±æ˜¯ä¸‹é¢çš„ä»£ç ï¼š<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++)&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; width; x++)&#123;<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> here you need to compute light sh of each pixel of each face of cubemap </span><br><br>        <span class="hljs-comment">//ç´¢å¼•åƒç´ å¯¹åº”çš„æ–¹å‘</span><br>        Eigen::Vector3f dir = cubemapDirs[i * width * height + y * width + x];<br>        <span class="hljs-comment">//åƒç´ çš„ç´¢å¼•</span><br>        <span class="hljs-type">int</span> index = (y * width + x) * channel;<br>        <span class="hljs-comment">//RGBå€¼</span><br>        <span class="hljs-function">Eigen::Array3f <span class="hljs-title">Le</span><span class="hljs-params">(images[i][index + <span class="hljs-number">0</span>], images[i][index + <span class="hljs-number">1</span>],</span></span><br><span class="hljs-params"><span class="hljs-function">                            images[i][index + <span class="hljs-number">2</span>])</span></span>;<br><br>        <span class="hljs-comment">// Edit Start</span><br>        <span class="hljs-keyword">auto</span> delta_w = <span class="hljs-built_in">CalcArea</span>(x, y, width, height);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> l = <span class="hljs-number">0</span>; l &lt;= SHOrder; l++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = -l; m &lt;= l; m++) &#123;<br>                <span class="hljs-comment">//è·å–åŸºå‡½æ•°</span><br>                <span class="hljs-keyword">auto</span> basic_sh_proj = sh::<span class="hljs-built_in">EvalSH</span>(l, m, Eigen::<span class="hljs-built_in">Vector3d</span>(dir.<span class="hljs-built_in">x</span>(), dir.<span class="hljs-built_in">y</span>(), dir.<span class="hljs-built_in">z</span>()).<span class="hljs-built_in">normalized</span>());<br>                <span class="hljs-comment">//è®¡ç®—leåœ¨åŸºå‡½æ•°ä¸Šçš„æŠ•å½±ï¼Œå¹¶ä¸”ç”¨é»æ›¼å’Œè¿‘ä¼¼ç§¯åˆ†</span><br>                SHCoeffiecents[sh::<span class="hljs-built_in">GetIndex</span>(l, m)] += Le * basic_sh_proj * delta_w;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// Edit End</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure> æœ€åç”Ÿæˆçš„<code>SHCoeffiecents</code>å¦‚ä¸‹ï¼š<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">    R               G               B<br><span class="hljs-number">1.91613</span>         <span class="hljs-number">1.71772</span>         <span class="hljs-number">1.07797</span><br><span class="hljs-number">-0.0591127</span>      <span class="hljs-number">-0.0574315</span>      <span class="hljs-number">-0.0346851</span><br><span class="hljs-number">-3.8612e-05</span>     <span class="hljs-number">-2.09015e-05</span>    <span class="hljs-number">-1.35017e-05</span><br><span class="hljs-number">0.439589</span>        <span class="hljs-number">-0.431271</span>       <span class="hljs-number">-0.0800766</span><br><span class="hljs-number">-0.0306302</span>      <span class="hljs-number">0.0319348</span>       <span class="hljs-number">0.00328068</span><br><span class="hljs-number">0.0758103</span>       <span class="hljs-number">0.0710374</span>       <span class="hljs-number">0.0591078</span><br><span class="hljs-number">0.311676</span>        <span class="hljs-number">0.269456</span>        <span class="hljs-number">0.309399</span><br><span class="hljs-number">-4.15644e-05</span>    <span class="hljs-number">6.26793e-05</span>     <span class="hljs-number">3.12488e-05</span><br><span class="hljs-number">-0.541544</span>       <span class="hljs-number">-0.468526</span>       <span class="hljs-number">-0.536088</span><br></code></pre></td></tr></table></figure></p>
<h2 id="é¢„è®¡ç®—å…‰ä¼ è¾“">é¢„è®¡ç®—å…‰ä¼ è¾“</h2>
<p>åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å·²ç»å°†ç¯å¢ƒå…‰ç…§æŠ•å½±åˆ°SHå‡½æ•°ä¸Šï¼Œå¾—åˆ°äº†å¯¹åº”çš„<code>SHCoeffiecents</code>ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†å¯¹äºæœ‰è‡ªé˜´å½±çš„<code>Shadowed</code>æ¼«åå°„ä¼ è¾“ï¼Œé¢„è®¡ç®—æ–¹ç¨‹å¤šäº†ä¸€é¡¹å¯è§æ€§(Visibility
term)ï¼š<br />
<span class="math display">\[
\begin{align}
L_{DS}=\frac{c}{\pi}\int_{S}V(w_i)max(N_x\cdot w_i,0)\text{d}w_i
\end{align} \tag{24}
\]</span>
å¯¹äºè¿™ä¸ªå¼å­ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨è’™ç‰¹å¡æ´›æ¥æ±‚ç§¯åˆ†ï¼Œè¿™é‡Œ<code>S</code>è¡¨ç¤ºæ•´ä¸ªçƒï¼Œå…¶å®æˆ‘è§‰å¾—ç”¨åŠçƒçš„<code>Cos weight</code>æ›´å¥½ï¼Œä½†æ˜¯å½“æ—¶æ˜¯ç›´æ¥å®ç°çš„æ•´çƒé‡‡æ ·ï¼Œåé¢å°±ä¸€ç›´æ²¡æ”¹äº†ã€‚æ‰€ä»¥ç°åœ¨è¿˜æ˜¯ä»¥æ•´çƒä¸ºä¾‹æ¥è®²è§£é‡‡æ ·è¿‡ç¨‹ï¼Œ<code>Cos weight</code>ç±»ä¼¼å…¶è¿‡ç¨‹ï¼š<br />
å•ä½çƒä¸Šçš„ä¸€ä¸ªé‡‡æ ·ç‚¹è½åœ¨<code>dw_i</code>çš„æ¦‚ç‡å¯†åº¦å‡½æ•°è®¾ä¸º<span
class="math inline">\(P(w_i)\)</span>ï¼š<br />
å¯¹äºè¿™ä¸ª<code>PDF</code>ï¼Œåœ¨æ•´çƒèŒƒå›´å†…ç§¯åˆ†ä¸º<code>1</code>ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç­‰å¼ï¼š<br />
<span class="math display">\[
\begin{align}
\int_{\phi}\int_{\theta}P(w_i)\text{d}w_i=1
\end{align} \tag{25}
\]</span>
ç”±äº<code>dw</code>åœ¨æ•´çƒèŒƒå›´å†…ç§¯åˆ†çš„ç»“æœæ˜¯<code>4Ï€R^2</code>ï¼Œå•ä½æ•´çƒåˆ™æ˜¯<code>4Ï€</code>ï¼Œ<code>PDF</code>çš„å€¼ä¸º<code>1/4Ï€</code>ï¼Œåˆ™ä¸Šè¿°å¼å­å¯ä»¥å†™æˆï¼š<br />
<span class="math display">\[
\begin{align}
\int_{\phi}\int_{\theta}\frac{1}{4\pi}\sin\theta\text{d}\theta\text{d}\phi=1
\end{align} \tag{26}
\]</span> åˆ†åˆ«è®¡ç®—å®ƒä»¬çš„è¾¹ç¼˜æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼š<br />
<span class="math display">\[
\begin{align}
&amp;
P(\theta)=\int_{0}^{2\pi}\frac{1}{4\pi}\sin\theta\text{d}\phi=\frac{\sin\theta}{2}
\\
&amp; P(\phi)=\int_{0}^{\pi}\frac{1}{4\pi}\sin\theta\text{d}\theta \\
&amp; =-\frac{1}{4\pi}\cos\theta|_{0}^{\pi} \\
&amp; =\frac{1}{2\pi}
\end{align} \tag{26}
\]</span> åˆ†åˆ«è®¡ç®—å®ƒä»¬çš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼š<br />
<span class="math display">\[
\begin{align}
&amp; F(\theta)=\int_{0}^{\theta}\frac{\sin\theta}{2}\text{d}\theta \\
&amp; =-\frac{\cos\theta}{2}|_{0}^{\theta} \\
&amp; =\frac{1-\cos\theta}{2} \\
&amp;
F(\phi)=\int_{0}^{\phi}\frac{1}{2\pi}\text{d}\phi=\frac{\phi}{2\pi}
\end{align} \tag{27}
\]</span> å‡åŒ€çš„ä»<code>U[0,1]</code>ä¸­å–å‡ºä¸¤ä¸ªéšæœºæ•°<span
class="math inline">\(X_{1}\)</span>å’Œ<span
class="math inline">\(X_{2}\)</span>,åˆ™æˆ‘ä»¬è¦çš„é‡‡æ ·<code>Î¸</code>å’Œ<code>Ï†</code>ä¸ºï¼š
<span class="math display">\[
\begin{align}
&amp; F^{-1}(\theta)=\theta=\arccos(1-2X_1) \\
&amp; F^{-1}(\phi)=\phi=2\pi X_2
\end{align} \tag{27}
\]</span> è¿™ç§æ–¹å¼å¾—åˆ°çš„é‡‡æ ·ç‚¹å¦‚ä¸‹ï¼š<br />
<img src="/img/00016/image-14.png" srcset="/img/loading.gif" lazyload alt="15" /><br />
æœ‰äº†é‡‡æ ·æ–¹å‘ï¼Œå°±å¯ä»¥ç®—ç§¯åˆ†å€¼äº†ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> t = <span class="hljs-number">0</span>; t &lt; sample_side; t++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> p = <span class="hljs-number">0</span>; p &lt; sample_side; p++) &#123;<br>        <span class="hljs-comment">//åˆ†å±‚é‡‡æ ·ï¼Œä½¿é‡‡æ ·ç‚¹æ›´åŠ å‡åŒ€ã€‚</span><br>        <span class="hljs-type">double</span> x1 = (t + nori::<span class="hljs-built_in">genRandomFloat</span>()) / sample_side;<br>        <span class="hljs-type">double</span> x2 = (p + nori::<span class="hljs-built_in">genRandomFloat</span>()) / sample_side;<br><br>        <span class="hljs-type">double</span> phi = <span class="hljs-number">2.0</span> * M_PI * x1;<br>        <span class="hljs-type">double</span> theta = <span class="hljs-built_in">acos</span>(<span class="hljs-number">2.0</span> * x2 - <span class="hljs-number">1.0</span>);<br><br>        <span class="hljs-type">double</span> func_value = <span class="hljs-built_in">func</span>(phi, theta);<br><br>        <span class="hljs-comment">// evaluate the SH basis functions up to band O, scale them by the</span><br>        <span class="hljs-comment">// function&#x27;s value and accumulate them over all generated samples</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> l = <span class="hljs-number">0</span>; l &lt;= order; l++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = -l; m &lt;= l; m++) &#123;<br>            <span class="hljs-type">double</span> sh = <span class="hljs-built_in">EvalSH</span>(l, m, phi, theta);<br>            <span class="hljs-comment">//è’™ç‰¹å¡æ´›ç§¯åˆ†</span><br>            <span class="hljs-type">double</span> pdf = <span class="hljs-number">1.0</span> / (<span class="hljs-number">4</span> * M_PI);<br>            (*coeffs)[<span class="hljs-built_in">GetIndex</span>(l, m)] += <span class="hljs-number">1</span> / M_PI * func_value * sh / pdf / sample_count;<br>        &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<code>func_value</code>å°±æ˜¯æ¸²æŸ“æ–¹ç¨‹ä¸­<code>Cos</code>å€¼ï¼Œå¦‚æœé¡¶ç‚¹å‘å¤–å‘å°„å…‰çº¿æ—¶æ²¡æœ‰è¢«æŒ¡ä½åˆ™<code>func_value == dot(N,w)</code>ï¼ŒæŒ¡ä½äº†å°±æ˜¯<code>0</code>ã€‚è‡³äºè¿™é‡Œ<code>Î¸</code>ä¸ºä»€ä¹ˆå’Œä¸Šé¢çš„å…¬å¼ä¸ä¸€æ ·ï¼Œæˆ‘å½“æ—¶æ˜¯ç›´æ¥ç”¨çš„<a
target="_blank" rel="noopener" href="https://www.bogotobogo.com/Algorithms/uniform_distribution_sphere.php">è¿™ç¯‡æ–‡ç« </a>ç®—å‡ºæ¥çš„ç»“æœï¼Œç°åœ¨è¿‡æ¥å†™åšå®¢æ—¶å‘ç°ä»–ç®—é”™äº†ï¼Œä¸è¿‡ä¸å½±å“æœ€åçš„ç»“æœï¼Œå°±æ˜¯Î¸å€¼äº’è¡¥ã€‚</p>
<h2 id="é¢„è®¡ç®—é—´æ¥å…‰ä¼ è¾“">é¢„è®¡ç®—é—´æ¥å…‰ä¼ è¾“</h2>
<p>æœ‰äº†ç›´æ¥å…‰çš„å…‰ä¼ è¾“ï¼Œé—´æ¥å…‰çš„å…‰ä¼ è¾“å°±å¥½åŠäº†ï¼Œä½†æ˜¯ç›´æ¥çœ‹ä½œä¸šæ–‡æ¡£ç»™çš„å…¬å¼å®¹æ˜“è¢«è¯¯å¯¼ï¼Œä¸è¿‡å¥½åœ¨å®ƒä¸‹é¢ç»™å‡ºäº†è§£é‡Šï¼Œæˆ‘è¿™é‡Œå°±ä¸åˆ—å…¬å¼äº†ï¼Œçœ‹ä¸‹å®ƒçš„è§£é‡Šï¼š<br />
1. å¯¹äºæ¯ä¸ªé¡¶ç‚¹ï¼Œè®¡ç®—å®ƒçš„<span
class="math inline">\(L_{DS}\)</span>ï¼Œåœ¨ä¸Šä¸€èŠ‚å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å·²ç»åšäº†è¿™ä¸ªäº‹æƒ…ï¼Œå¯ä»¥æ‹¿æ¥å¤ç”¨ã€‚<br />
2.
ä»å½“å‰é¡¶ç‚¹å‘å°„å…‰çº¿ï¼Œå¦‚æœå½“å‰å…‰çº¿ä¸å…¶ä»–ä¸‰è§’å½¢ç›¸äº¤ï¼Œåˆ™åœ¨äº¤ç‚¹å¤„æ±‚å‡ºé‡å¿ƒåæ ‡æ’å€¼åçš„çƒé¢è°æ³¢ç³»æ•°ï¼Œè¿™ä¸ªç³»æ•°å°±è¡¨ç¤ºé—´æ¥å…‰ç…§çš„çƒé¢è°æ³¢ç³»æ•°ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®ä¸ç”¨ç®—ç§¯åˆ†å€¼ã€‚<br />
3. å¯¹äºè¿™ä¸ªåå°„å›æ¥çš„é—´æ¥å…‰ï¼Œä¹˜ä»¥å‡ ä½•é¡¹<code>dot(N,w_i)</code>ã€‚<br />
4. ä»¥å½“å‰å°„çº¿ä¸ºäº¤ç‚¹ï¼Œä»ç¬¬<code>2</code>æ­¥è®¡ç®—ä»¥å½“å‰äº¤ç‚¹ä¸ºåˆè¯•é¡¶ç‚¹çš„<span
class="math inline">\(L_{DS}\)</span>ï¼Œé‡å¤è¿™ä¸ªæ­¥éª¤ç›´åˆ°<code>Bounce</code>æ¬¡æ•°åˆ°è¾¾é¢„è®¾å€¼ï¼Œç„¶åç»“æŸé€’å½’ã€‚<br />
å®ç°å¦‚ä¸‹ï¼š<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>std::unique_ptr&lt;std::vector&lt;<span class="hljs-type">double</span>&gt;&gt; <span class="hljs-built_in">computeInterreflectionSH</span>(Eigen::MatrixXf* directTSHCoeffs, <br>                                                            <span class="hljs-type">const</span> Point3f&amp; pos, <span class="hljs-type">const</span> Normal3f&amp; normal, T&amp;&amp; Lds,<br>                                                            <span class="hljs-type">const</span> Scene* scene, <span class="hljs-type">int</span> bounces)<br>&#123;<br>    std::unique_ptr&lt;std::vector&lt;<span class="hljs-type">double</span>&gt;&gt; <span class="hljs-built_in">coeffs</span>(<span class="hljs-keyword">new</span> std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">double</span>&gt;());<br>    coeffs-&gt;<span class="hljs-built_in">assign</span>(SHCoeffLength, <span class="hljs-number">0.0</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; coeffs-&gt;<span class="hljs-built_in">size</span>(); i++)&#123;<br>        (*coeffs)[i] += Lds[i];<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (bounces &gt;= m_Bounce)<br>        <span class="hljs-keyword">return</span> coeffs;<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> sample_side = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">sqrt</span>(m_SampleCount)));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> t = <span class="hljs-number">0</span>; t &lt; sample_side; t++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> p = <span class="hljs-number">0</span>; p &lt; sample_side; p++) &#123;<br>            <span class="hljs-type">double</span> x1 = (t + nori::<span class="hljs-built_in">genRandomFloat</span>()) / sample_side;<br>            <span class="hljs-type">double</span> x2 = (p + nori::<span class="hljs-built_in">genRandomFloat</span>()) / sample_side;<br>            <span class="hljs-type">double</span> phi = <span class="hljs-number">2.0</span> * M_PI * x1;<br>            <span class="hljs-type">double</span> theta = <span class="hljs-built_in">acos</span>(<span class="hljs-number">2.0</span> * x2 - <span class="hljs-number">1.0</span>);<br><br>            Eigen::Array3d d = sh::<span class="hljs-built_in">ToVector</span>(phi, theta);<br>            <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> wi = <span class="hljs-built_in">Vector3f</span>(d.<span class="hljs-built_in">x</span>(), d.<span class="hljs-built_in">y</span>(), d.<span class="hljs-built_in">z</span>());<br>            <span class="hljs-type">double</span> pdf = <span class="hljs-number">1.0</span> / (<span class="hljs-number">4</span> * M_PI);<br>            <span class="hljs-type">double</span> H = wi.<span class="hljs-built_in">normalized</span>().<span class="hljs-built_in">dot</span>(normal);<br>            Intersection its;<br>            <span class="hljs-keyword">if</span> (H &gt; <span class="hljs-number">0.0</span> &amp;&amp; scene-&gt;<span class="hljs-built_in">rayIntersect</span>(<span class="hljs-built_in">Ray3f</span>(pos, wi.<span class="hljs-built_in">normalized</span>()), its))&#123;<br>                MatrixXf normals = its.mesh-&gt;<span class="hljs-built_in">getVertexNormals</span>();<br>                Point3f idx = its.tri_index;<br>                Point3f hitPos = its.p;<br>                Vector3f bary = its.bary;<br>                <span class="hljs-comment">//åˆ©ç”¨é‡å¿ƒåæ ‡æ’å€¼ä¸‰è§’å½¢å„é¡¶ç‚¹çš„æ³•å‘é‡</span><br>                Normal3f hitNormal =<br>                    <span class="hljs-built_in">Normal3f</span>(normals.<span class="hljs-built_in">col</span>(idx.<span class="hljs-built_in">x</span>()).<span class="hljs-built_in">normalized</span>() * bary.<span class="hljs-built_in">x</span>() +<br>                        normals.<span class="hljs-built_in">col</span>(idx.<span class="hljs-built_in">y</span>()).<span class="hljs-built_in">normalized</span>() * bary.<span class="hljs-built_in">y</span>() +<br>                        normals.<span class="hljs-built_in">col</span>(idx.<span class="hljs-built_in">z</span>()).<span class="hljs-built_in">normalized</span>() * bary.<span class="hljs-built_in">z</span>())<br>                    .<span class="hljs-built_in">normalized</span>();<br>                <span class="hljs-comment">//é‡å¿ƒåæ ‡æ’å€¼ä¸‰è§’å½¢å„é¡¶ç‚¹çš„(V * brdf * wiDotN)æŠ•å½±åˆ°çƒè°åŸºå‡½æ•°åå¾—åˆ°çš„coeffså€¼</span><br>                <span class="hljs-keyword">auto</span> interpolateSH = <br>                        directTSHCoeffs-&gt;<span class="hljs-built_in">col</span>(idx.<span class="hljs-built_in">x</span>()) * bary.<span class="hljs-built_in">x</span>() +<br>                        directTSHCoeffs-&gt;<span class="hljs-built_in">col</span>(idx.<span class="hljs-built_in">y</span>()) * bary.<span class="hljs-built_in">y</span>() +<br>                        directTSHCoeffs-&gt;<span class="hljs-built_in">col</span>(idx.<span class="hljs-built_in">z</span>()) * bary.<span class="hljs-built_in">z</span>();<br>                <span class="hljs-keyword">auto</span> nextBouncesCoeffs = <span class="hljs-built_in">computeInterreflectionSH</span>(directTSHCoeffs, hitPos, hitNormal, interpolateSH ,scene, bounces + <span class="hljs-number">1</span>);<br><br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; SHCoeffLength; i++)&#123;<br>                    <span class="hljs-comment">//é‡‡æ ·åˆ°æŠ•å½±åçš„coeffesä¹˜ä»¥cosåšæƒé‡ï¼Œè¿™é‡Œä¸æ˜¯è’™ç‰¹å¡æ´›ç§¯åˆ†ã€‚</span><br>                    (*coeffs)[i] +=  (*nextBouncesCoeffs)[i] * H / m_SampleCount;<br>                    <span class="hljs-comment">// (*coeffs)[i] += 1 / M_PI * (*nextBouncesCoeffs)[i] * H / pdf / m_SampleCount;//Incorrect method</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> coeffs;<br>&#125;<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> leave for bonus</span><br>m_InterTransportSHCoeffs.<span class="hljs-built_in">resize</span>(SHCoeffLength, mesh-&gt;<span class="hljs-built_in">getVertexCount</span>());<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> omp parallel for</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; mesh-&gt;<span class="hljs-built_in">getVertexCount</span>(); i++)&#123;<br>    <span class="hljs-type">const</span> Point3f&amp; v = mesh-&gt;<span class="hljs-built_in">getVertexPositions</span>().<span class="hljs-built_in">col</span>(i);<br>    <span class="hljs-type">const</span> Normal3f&amp; n = mesh-&gt;<span class="hljs-built_in">getVertexNormals</span>().<span class="hljs-built_in">col</span>(i).<span class="hljs-built_in">normalized</span>();<br>    <span class="hljs-keyword">auto</span> indirectCoeffs = <span class="hljs-built_in">computeInterreflectionSH</span>(&amp;m_TransportSHCoeffs, v, n,m_TransportSHCoeffs.<span class="hljs-built_in">col</span>(i), scene, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; SHCoeffLength; j++)&#123;<br>        m_InterTransportSHCoeffs.<span class="hljs-built_in">col</span>(i).<span class="hljs-built_in">coeffRef</span>(j) = (*indirectCoeffs)[j];<br>    &#125;<br>&#125;<br>m_TransportSHCoeffs = m_InterTransportSHCoeffs;<br></code></pre></td></tr></table></figure> æ•ˆæœå¦‚ä¸‹ï¼š<br />
<img src="/img/00016/PRT.gif" srcset="/img/loading.gif" lazyload alt="16" /><br />
è¯»è€…æœ‰æ—¶é—´å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼Œå§å¯¹æ•´çƒçš„é‡‡æ ·æ”¹æˆ<code>cos weight</code>åŠçƒé‡‡æ ·ï¼Œé€Ÿåº¦æ›´å¿«æ•ˆæœæ›´å¥½ã€‚</p>
<h2 id="ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ®è¿›è¡Œshading">ä½¿ç”¨é¢„è®¡ç®—çš„æ•°æ®è¿›è¡ŒShading</h2>
<p>æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸Šé¢5å¼çš„ç»“æœï¼š<br />
<span class="math display">\[
\begin{align}
&amp; L_o(p,w_o)=\sum_il_it_i
\end{align}
\]</span>
åœ¨<code>webgl</code>ä¸­è¦åšçš„äº‹æƒ…å°±æ˜¯å°†é¢„è®¡ç®—çš„<code>SHCoeffiecents</code>å‘é‡ï¼Œä¼ å…¥åˆ°é¡¶ç‚¹ç€è‰²å™¨é‡Œï¼Œç„¶åé€ç‚¹ç›¸ä¹˜å†æ±‚å’Œï¼Œå°±æ˜¯æˆ‘ä»¬è¦çš„é¢œè‰²å€¼ã€‚æœ€ååšä¸€ä¸‹<code>Gamma Correction</code>å’Œ<code>Tone Mapping</code>å°†çº¿æ€§ç©ºé—´çš„é¢œè‰²è½¬æ¢åˆ°sRGBç©ºé—´ã€‚<br />
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp">attribute vec3 aVertexPosition;<br>attribute vec3 aNormalPosition;<br><span class="hljs-comment">//å…‰ä¼ è¾“æŠ•å½±åˆ°å‰ä¸‰å±‚SHå‡½æ•°å¾—åˆ°çš„ç³»æ•°ï¼Œä¸€ä¸ªé¡¶ç‚¹åŒ…å«9ä¸ªç³»æ•°ï¼Œç”¨mat3æ¥å­˜å‚¨ã€‚</span><br>attribute mat3 aPrecomputeLT;<br><span class="hljs-comment">//å…‰ç…§æŠ•å½±åˆ°å‰ä¸‰å±‚SHå‡½æ•°å¾—åˆ°çš„ç³»æ•°ï¼Œä¸€ä¸ªé¡¶ç‚¹åŒ…å«27ä¸ªç³»æ•°ï¼ŒRå¯¹åº”9ä¸ªï¼ŒGå¯¹åº”9ä¸ªï¼ŒBå¯¹åº”9ä¸ªï¼Œç”¨ä¸‰ä¸ªmat3æ¥å­˜å‚¨</span><br>uniform mat3 uPrecomputeL[<span class="hljs-number">3</span>];<br>varying highp vec3 vColor;<br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">L_dot_LT</span><span class="hljs-params">(mat3 PrecomputeL, mat3 PrecomputeLT)</span> </span>&#123;<br>  vec3 L_0 = PrecomputeL[<span class="hljs-number">0</span>];<br>  vec3 L_1 = PrecomputeL[<span class="hljs-number">1</span>];<br>  vec3 L_2 = PrecomputeL[<span class="hljs-number">2</span>];<br>  vec3 LT_0 = PrecomputeLT[<span class="hljs-number">0</span>];<br>  vec3 LT_1 = PrecomputeLT[<span class="hljs-number">1</span>];<br>  vec3 LT_2 = PrecomputeLT[<span class="hljs-number">2</span>];<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">dot</span>(L_0, LT_0) + <span class="hljs-built_in">dot</span>(L_1, LT_1) + <span class="hljs-built_in">dot</span>(L_2, LT_2);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)&#123;<br>    <span class="hljs-comment">//RGBå¯¹åº”çš„SHç³»æ•°åˆ†åˆ«åšç‚¹ä¹˜ï¼Œå¾—åˆ°æœ€åRGBå€¼ã€‚</span><br>    vColor[i] = <span class="hljs-built_in">L_dot_LT</span>(uPrecomputeL[i],aPrecomputeLT);<br>  &#125;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>
è¿™ä¸ª<code>Gamma Correction</code>å’Œ<code>Tone Mapping</code>åœ¨<code>Nori</code>æ¡†æ¶ä¸­æœ‰ä¸ªAPIå·²ç»å®ç°ï¼Œæˆ‘ä»¬ç”¨å®ƒé‚£ä¸ªå°±è¡Œï¼š
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Color3f <span class="hljs-title">Color3f::toSRGB</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    Color3f result;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">3</span>; ++i) &#123;<br>        <span class="hljs-type">float</span> value = <span class="hljs-built_in">coeff</span>(i);<br>        <span class="hljs-keyword">if</span> (value &lt;= <span class="hljs-number">0.0031308f</span>)<br>            result[i] = <span class="hljs-number">12.92f</span> * value;<br>        <span class="hljs-keyword">else</span><br>            result[i] = (<span class="hljs-number">1.0f</span> + <span class="hljs-number">0.055f</span>)<br>                * std::<span class="hljs-built_in">pow</span>(value, <span class="hljs-number">1.0f</span>/<span class="hljs-number">2.4f</span>) -  <span class="hljs-number">0.055f</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Games202/" class="category-chain-item">Games202</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Games202 Hw2 Precomputed Radiance Transfer</div>
      <div>https://howl144.github.io/2023/05/29/00016. Games202 Hw2/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Deng Ye</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>May 29, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/06/10/00017.%20Games202%20Hw3/" title="Games202 Hw3 Screen Space Ray Tracing">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Games202 Hw3 Screen Space Ray Tracing</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/05/29/00015.%20Games202%20Hw1/" title="Games202 Hw2 Precomputed Radiance Transfer">
                        <span class="hidden-mobile">Games202 Hw2 Precomputed Radiance Transfer</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        Views: 
        <span id="leancloud-site-pv"></span>
        
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        Visitors: 
        <span id="leancloud-site-uv"></span>
        
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
